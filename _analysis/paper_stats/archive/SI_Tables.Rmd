---
title: 'Supplementary Tables'
output:
  html_document:
    code_folding: show
    highlight: haddock
    theme: cerulean
    toc: yes
    toc_depth: 4
    toc_float: yes
    number_sections: no
editor_options: 
  chunk_output_type: console
---


```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

library(knitr)
library(xtable)
library(pander)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
library(kableExtra)
library(stringr)
options(knitr.kable.NA = '')

```

#### Supplementary Table 1: Total global pressures
Total global pressures measured across all included food types, used to rescale raster pressure data.

```{r total pressures, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, asis=TRUE}

units_df <- data.frame(pressure = c("ghg", "nutrient", "disturbance", "water"),
                       units = c("tonnes CO2eq", "tonnes N and P", "km2eq", "m3"))

pressure <- read.csv(here("_analysis/rescale_values.csv")) %>%
  left_join(units_df) %>%
  select(pressure, "global total" = global_total, units)

kable(pressure) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")
#kable_styling(x_html, "striped", position = "left", font_size = 7)

```

#### Supplementary Table 2: Distribution of global cumulative pressures: marine vs. land
Percent of global cumulative pressures in ocean (EEZ), freshwater, and land.

```{r global marine vs land, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, asis=TRUE}

land_ocean <- read.csv(here("_analysis/paper_stats/supp_tables/percent_cum_pressure_origin.csv")) %>%
  select(-prop_final, -X) %>%
  pivot_wider(names_from = origin, values_from=percent_final)

kable(land_ocean) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")
#kable_styling(x_html, "striped", position = "left", font_size = 7)

```

#### Supplementary Table 3: Distribution of cumulative pressures: marine vs. land
Percent of a countries cumulative pressures in ocean (EEZ), freshwater, and land.

```{r country marine vs land, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, asis=TRUE}

## NOTE: wasn't sure if the version with freshwater would be better

land_ocean <- read.csv(here("_analysis/paper_stats/supp_tables/percent_cum_pressure_country_origin_fw.csv")) %>%
  select(-cum_pressure_prop_final) %>%
  pivot_wider(names_from = origin, values_from=cum_pressure_percent_final) %>%
  arrange(country)

kable(land_ocean) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")
#kable_styling(x_html, "striped", position = "left", font_size = 7)

```


#### Supplementary Table 4: Percent of global cumulative pressure generated by each organism
For fed animals (livestock and marine aquaculture) pressures include those from feed (crops, fodder, and fishmeal/fish oil). Crop and marine fishmeal fish oil represent only the pressures remaining after animal feed has been accounted for (in order to avoid double counting pressures), which results in seemingly low cumulative pressures for crops that are mostly used as animal feed. 

```{r organism percent, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

names <- readr::read_csv(here("_analysis/paper_stats/TableNames.csv"))

org_percent <- read.csv(here("_analysis/paper_stats/supp_tables/percent_cum_pressure_organism.csv")) %>%
  rename(food_tybe_abb = organism) %>%
  left_join(names, by = c("food_tybe_abb")) %>%
  mutate(organism = paste(food_group, food_type, sep=": ")) %>%
  arrange(-percent_final) %>%
  mutate(percent = round(prop_final*100, 2)) %>%
  select(organism, "percent of global cumulative pressure" = percent) 
  
kable(org_percent) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")  

```

#### Supplementary Table 5: Dominant food groups 

Proportion of global ocean and land raster cells where a single food group accounts for the majority of cumulative pressure (CP, >50% and >80% of cumulative pressure).  Figure 3c shows the spatial distribution of the dominant food group. Figure 3a (land) and b (ocean) shows the spatial distribution of the dominant foods. 

```{r dominant food, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

org_percent <- read.csv(here("_analysis/paper_stats/supp_tables/land_ocean_food_dominations_props.csv")) %>%
  mutate(domination_threshold = paste0("> ", domination_threshold, " CP")) %>%
    pivot_wider(names_from = domination_threshold, values_from=prop_dom) %>%
  mutate(food_group = gsub("_", ": ", food_group),
         food_group = gsub("\\.", " ", food_group)) %>%
  select(area, "food group" = "food_group", `> 50% CP`, `> 80% CP`) %>%
  arrange(area, -`> 50% CP`)

kable(org_percent) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")  

test <- org_percent %>%
  filter(area == "land")

#sum(test$`> 50% CP`) # 0.7314649

test2 <- org_percent %>%
  filter(area == "ocean")

#sum(test2$`> 50% CP`) # 0.791794
```

#### Supplementary Table 6: Dominant pressure 
Proportion of global ocean and land raster cells where a single pressure accounts for the majority of cumulative pressure (CP, >50% and >80% of cumulative pressure).  Figure 3c shows the spatial distribution of the dominant pressure. 

```{r dominant stressor, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

stressor_percent <- read.csv(here("_analysis/paper_stats/supp_tables/land_ocean_pressure_dominations_props.csv")) %>%
  select(area, pressure, domination_threshold, proportion_dominated) %>%
  mutate(domination_threshold = paste0("> ", domination_threshold, " CP")) %>%
    pivot_wider(names_from = domination_threshold, values_from=proportion_dominated) %>%
  select(area, pressure, `> 50% CP`, `> 80% CP`) %>%
  arrange(area, -`> 50% CP`)

kable(stressor_percent) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")  

```


#### Supplementary Table 7: Efficiency (cumulative pressure per tonne production) statistics for major food groups 
For each food type we calculated the median, 10th and 90th quantiles of the country values.  Feed for animals is reported separately for each animal group. (Corresponds to Figure 5)
```{r efficiency, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

efficiency <- read.csv(here("_analysis/paper_stats/supp_tables/pressure_per_tonne_ranges.csv"))

efficiency_animal_feed <- efficiency %>%
  filter(str_detect(category1_production, "feed")) %>%
  filter(!str_detect(category1_production, "fish|shrimp|bivalve|tuna|salmon|crusta")) %>%
  mutate(type = "livestock") %>%
  unite(type, category1_production, remove = FALSE, sep = " ", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_mar_feed <- efficiency %>%
  filter(str_detect(category1_production, "feed")) %>%
  filter(str_detect(category1_production, "fish|shrimp|bivalve|tuna|salmon|crusta")) %>%
  mutate(type = "marine aquaculture") %>%
  unite(type, category1_production, remove = FALSE, sep = " ", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_fisheries <- efficiency %>%
  filter(str_detect(category1_production, "benthic|pelagic|demersal|reef|fofm")) %>%
  mutate(type = "marine fisheries") %>%
  unite(type, category1_production, remove = FALSE, sep = "_", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_mar <- efficiency %>%
  filter(!str_detect(category1_production, "feed")) %>%
  filter(str_detect(category1_production, "general|shrimp|bivalve|tuna|salmon|crusta")) %>%
  mutate(type = "marine aquaculture") %>%
  unite(type, category1_production, remove = FALSE, sep = "_", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_fw_fish <- efficiency %>%
  filter(str_detect(category1_production, "fish_meat")) %>%
  mutate(type = "freshwater fisheries") %>%
  unite(type, category1_production, remove = FALSE, sep = "_", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_produce <- efficiency %>%
    filter(str_detect(category1_production, "produce")) %>%
  mutate(type = "crop") %>%
  unite(type, category1_production, remove = FALSE, sep = "_", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))


efficiency_livestock <- efficiency %>%
  filter(!str_detect(category1_production, "feed")) %>%
  filter(str_detect(category1_production, "buff|chick|goat|pig|cow|sheep")) %>%
  mutate(type = "livestock") %>%
  unite(type, category1_production, remove = FALSE, sep = "_", col = "new_category1_production") %>%
  mutate(new_category1_production = gsub("_", ": ", new_category1_production),
         new_category1_production = gsub("\\.", " ", new_category1_production))

efficiency_all <- rbind(efficiency_animal_feed, efficiency_fisheries, efficiency_fw_fish, efficiency_livestock, efficiency_mar, efficiency_mar_feed, efficiency_produce) %>%
  select(-category1_production) %>%
  select("food type" = new_category1_production, "10th quantile" = quant_10_ppt, median = median_ppt, "90th quantile"= quant_90_ppt) %>%
  arrange(-median)


kable(efficiency_all) %>%
 kableExtra::kable_styling("striped", full_width = FALSE, position = "left")  


```